&emsp;2018年2月，我参加了某市智慧城市集成平台项目的研发，该项目的主要目的是经过多种渠道获取该市各种突发事件和各部门数据；通过对事件的紧急处理和数据的分析产生出决策并下发指令以提高办公效率。我在项目中承担架构设计师的职务，主要负责系统的技术选型、架构设计以及部分软件设计工作。本文以其中的智慧应急系统为例，介绍SOA在企业集成架构设计中的具体应用。**通过webService和注册中心将上报系统与指挥系统解耦；通过ESB实现与各部门系统的集成；通过服务编排BPEL实现指挥中心内部业务处理流程的集成**。通过以上SOA技术的应用，最终项目顺利上线且稳定运行，并得到客户和各级领导的一致赞赏。

&emsp;随着互联网的崛起，某市响应政府的政策和号召，为了解决该城市中突发事件汇报不及时、上呈下达效率慢时间长、流程繁琐以及该市建设中不合理的隐匿问题以便更好的为人民服务；参考国外智能化城市建设的优势，决定发起智慧城市的项目。2018年2月，我司竞标该项目成功并承担了该市智慧城市项目的开发工作。该项目的主要目的是经过多种渠道获取该市各种事件信息（安保事故、消防事故、交通事故、地震、洪涝灾害等突发事件）和数据（主要是政府各职能部门如林业局，公安局，消防大队，具体涉及高铁、机场、林场、水库、公交、红绿灯、摄像头等相关设备的数据）；通过对事件的紧急处理和数据的分析产生出决策并下发指令以提高政府办公的速度，更快速更高效的解决突发事件。我在项目中担任架构设计师职务，架构小组共4人，我主要负责整体架构设计和部分软件设计，整个项目历时10个月，2018年12月顺利通过验收。
&emsp;智慧应急系统按职责可将整体划分为上报系统（用于上报事件和紧急情况，如公众号，网格员APP的后端）、各部门系统（各个职能部门的系统，如公安局、林业局、电厂、消防大队，用于同步数据）、指挥中心系统（用于事件处理、接收数据、决策分析和下达指令）。需要将指挥中心内部服务以及与以上两部分系统的服务集成以实现统一的事件收集和处理、数据分析决策和指令下发的功能。我通过对现有的各系统进行调研，结论如下：由于上报系统的很多项目在运行平台和实现语言上实现较大，适合将各部分包装成服务来实现跨语言和跨平台访问；对于各部门系统和指挥中心系统之间联系复杂且数据格式不统一，适合采用服务总线ESB进行集成；由于指挥系统内部对事件流程以及办公流程的改动非常频繁，导致花费很多成本对内部的众多项目进行改造，适合采用服务流程编排BPEL的方式来进行集成。综上所述，我觉得采用SOA的架构设计方法对各系统进行集成。
&emsp;SOA是一种应用程序架构，所有功能都被定义为独立的服务，服务之间通过交互和协调完成业务的整体逻辑。SOA指定了一组实体，包括服务提供者、服务消费者、服务注册中心、服务条款、服务代理和服务契约。这些实体详细说明了如何提供和消费服务。服务提供者提供符合契约的服务，并将他们发布到服务代理。这些服务都是无状态的实体，可以由多个组件组成。服务代理者作为存储库、目录库或票据交换所，产生由服务提供者发布的事先定义的标准化接口，使得服务可以提供给在任何异构平台和任何用户接口使用。这种松散耦合和跨技术实现，使各服务在交互过程中无需考虑双方的内部细节、实现技术以及部署在什么平台上，服务消费者只要提出服务请求，就可以发现并调用其他的软件服务得到答案。SOA作为一种粗粒度、松耦合的架构，具有松散耦合、粗粒度服务、标准化接口、位置和传输协议透明、服务封装和重用、服务的互操作等几个特点。下面我将介绍SOA在此平台中的应用。
&emsp;**1、通过webService服务调用集成上报系统和指挥系统**
&emsp;指挥中心系统部分需要接收上报系统中各异构项目的事件上报，我采取webService服务调用的方式进行集成。SOA中的服务调用角色分为服务提供者、注册中心和服务请求者。所谓的服务提供者主要完成服务的设计、描述、定义和发布等相关工作，在这里我将指挥中心中相关的项目包装为服务，为上报系统的项目提供数据上报的标准服务接口，待完成设计后，采用WSDL进行服务描述，而后再利用UDDI技术将这些服务信息发布至注册中心，公布查找和定位服务的方法。服务注册中心的存在使得服务请求者与服务提供者之间的进一步解耦。服务注册中心中包含有已发布指挥中心项目服务中的描述信息，其描述信息主要包括功能描述、参数描述、接口定义等相关信息。上报系统中的相关项目作为服务请求者通过webService技术调用服务，服务请求者通过注册中心获取提供者的接口、参数等相关服务信息，使用工具生成对应的调用代码，之后根据具体情况选择不同的定位方式，传递服务所需的相关参数，最终由提供者处理后返回。在此期间服务请求者无需了解服务地址以及是如何对数据进行处理和分析的。
&emsp;**2、通过ESB服务总线集成各部门系统和指挥系统**
&emsp;由于现有的指挥中心系统需要获取各个职能部门系统的数据进行决策分析，导致两个系统中很多项目的联系错综复杂以及数据格式有很大差异。导致两个系统紧耦合，对今后的维护和开发造成很大困难。为此我采用ESB服务总线将两个系统进行集成。ESB作为一种非常优秀的集成技术，具有服务位置透明性、传输协议转换、消息格式转换、消息路由、消息增强、安全支持和监控与管理的强大功能，可以很好的将现有部门系统的项目于指挥系统的项目解耦，降低维护和开发成本。ESB的优势如下：1.从系统部署方式上讲，采用ESB能够实现灵活的部署结构，包括C/S结构，P2P结构等；2.从待集成系统的耦合程度上讲，采用ESB技术，待集成系统只需要与总线进行联系，彼此之间不需要互相通信，可以大大降低系统间的耦合度；3.从系统的可扩展性上讲，采用ESB技术，在加入新的待集成系统时，只需要采用插件和适配器的方式实现传输协议和数据格式的适配即可，系统的可扩展性强。因此采用ESB完成此场景下的集成。
&emsp;**3、通过BPEL服务流程编排技术实现指挥中心中各项目的集成**
&emsp;指挥系统部分中有一核心功能是负责对接收的上报事件以及各部门的工作汇报进行处理。由于事件的涉及到各种类型，不同职能的部门汇报内容不同造成处理流程复杂。其次为了实时响应国家的新政策，需要经常对这些复杂的处理流程进行改动，因为其复杂程度高，每次都需要花费很大的人力和时间成本对多个项目进行改造而且很多时候为了避免影响现有的流程进行开发新的项目。因此我通过调研后采用服务流程编排技术BPEL对指挥中心的各个项目进行集成。BPEL技术通过建模软件可以通过拖拽组件的方式轻易的将新的流程进行编排并生成XML配置文件，然后通过BPEL引擎进行解析执行后完成编排流程的集成。通过引用此技术很大程度上消除了处理流程相关项目之间的复杂依赖并解决了这些项目的重用问题，提高了该指挥系统的可修改性，降低了二次开发成本。
&emsp;整个项目历时10个月完成，于2018年12月交付，到目前为止稳定运行。得到各级客户和各级领导的赞赏。由此证明，SOA技术在系统集成方面有很大的优势，可以大大提高开发效率，节省开发和维护成本，提高集成项目的质量。我会从该项目中总结经验，为以后在应对面向服务架构SOA的架构设计中打下坚实基础。
